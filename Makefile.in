# $Id: Makefile.in,v 1.1 1999-02-26 19:04:45 danw Exp $

SHELL=/bin/sh
INSTALL=@INSTALL@
INSTALL_PROGRAM=@INSTALL_PROGRAM@
RANLIB=@RANLIB@
VPATH=@srcdir@
srcdir=@srcdir@
top_srcdir=@top_srcdir@
prefix=@prefix@
exec_prefix=@exec_prefix@
libdir=@libdir@
includedir=@includedir@
mandir=@mandir@

CC=@CC@
CPPFLAGS=@CPPFLAGS@
CFLAGS=@CFLAGS@
DEFS=@DEFS@ -DMOUNT_CMD=\"@MOUNT_CMD@\" -DUMOUNT_CMD=\"@UMOUNT_CMD@\"
LDFLAGS=@LDFLAGS@
MOST_CFLAGS=-I. ${CPPFLAGS} ${CFLAGS} ${DEFS}
ALL_CFLAGS=${WARN_CFLAGS} ${ERROR_CFLAGS} ${MOST_CFLAGS}

OBJS=	afs.o attach.o attachtab.o conf.o detach.o misc.o miscfs.o \
	mount.o mountpoint.o mul.o nfs.o util.o zephyr.o

all: liblocker.a

liblocker.a: ${OBJS}
	ar cru $@ ${OBJS}
	${RANLIB} $@

${OBJS}: locker.h locker_private.h

# AFS includes (3.4a at least) won't survive WARN_CFLAGS
afs.o: afs.c
	${CC} -c ${MOST_CFLAGS} $<

.c.o:
	${CC} -c ${ALL_CFLAGS} $<

check:

install:
	${top_srcdir}/mkinstalldirs ${DESTDIR}${libdir}
	${top_srcdir}/mkinstalldirs ${DESTDIR}${includedir}
	${top_srcdir}/mkinstalldirs ${DESTDIR}${mandir}/man3
	${top_srcdir}/mkinstalldirs ${DESTDIR}${mandir}/man5
	${INSTALL} -m 644 liblocker.a ${DESTDIR}${libdir}
	${RANLIB} ${DESTDIR}${libdir}/liblocker.a
	chmod u-w ${DESTDIR}${libdir}/liblocker.a
	${INSTALL} -m 644 ${srcdir}/locker.h ${DESTDIR}${includedir}
	${INSTALL} -m 644 ${srcdir}/man/locker_attach.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_attach_attachent.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_attach_explicit.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_auth.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_auth_to_cell.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_auth_to_host.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_detach.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_detach_attachent.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_detach_explicit.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_check_host.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_check_owner.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_end.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_free_attachent.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_init.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_iterate_attachtab.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_read_attachent.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/locker_zsubs.3 \
		${DESTDIR}${mandir}/man3
	${INSTALL} -m 644 ${srcdir}/man/attach.conf.5 \
		${DESTDIR}${mandir}/man5
	${INSTALL} -m 644 ${srcdir}/man/attachtab.5 \
		${DESTDIR}${mandir}/man5

clean:
	rm -f ${OBJS} liblocker.a

distclean: clean
	rm -f config.cache config.log config.status Makefile
